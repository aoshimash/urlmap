# CLAUDE.md - urlmap プロジェクトのAI開発ガイドライン

このファイルは、Claude Code (AI開発アシスタント) がurlmapプロジェクトで作業する際に従うべきガイドラインを定義します。

## 開発プロセス

### 必須: テスト駆動開発 (TDD) の実践

**すべての機能実装は必ずTDDで行うこと:**

1. **テストファースト**: 実装前に必ずテストを作成する
2. **Red-Green-Refactor サイクル**:
   - Red: まずテストを書き、テストが失敗することを確認する
   - Green: テストを通すための最小限の実装を行う
   - Refactor: コードを改善する（テストは常にグリーンを維持）

### テスト要件

1. **ローカルテストとCIの一致**:
   - ローカルで実行可能なすべてのテストはCI上でも実行されること
   - 例外: PlaywrightなどのE2Eテスト（実行時間の問題がある場合のみ）

2. **PRに含めるべきもの**:
   - 新機能のテストコード（unit test, integration test）
   - テストが通る実装コード
   - 必要に応じてe2eテストやperformanceテスト

3. **テストカバレッジ**:
   - 新規コードは可能な限り高いカバレッジを目指す
   - 既存のテストが壊れないことを確認する

## 実装手順の例

```bash
# 1. まずテストを作成
# internal/feature/feature_test.go を作成

# 2. テストが失敗することを確認
go test ./internal/feature/...

# 3. 実装を追加
# internal/feature/feature.go を実装

# 4. テストが通ることを確認
go test ./internal/feature/...

# 5. 全体のテストを実行
go test ./...
```

## コマンドとツール

### テスト実行
```bash
# 全テストを実行
go test ./...

# 特定のパッケージのテストを実行
go test ./internal/crawler/...

# verboseモードでテスト実行
go test -v ./...

# レースコンディション検出付きでテスト
go test -race ./...

# カバレッジ付きでテスト
go test -cover ./...
```

### Lint/型チェック
```bash
# 実装完了後は必ず実行
go fmt ./...
go vet ./...
golangci-lint run  # インストールされている場合
```

## 禁止事項

1. **テストなしでの機能実装は禁止**
2. **既存テストを壊すような変更は禁止**（意図的なリファクタリングを除く）
3. **CI環境とローカル環境で異なる挙動をするテストの作成は禁止**

## 推奨事項

1. **小さなコミット**: 機能を小さく分割し、各ステップでテストを書く
2. **わかりやすいテスト名**: テストの意図が明確になる名前を使用
3. **テストの独立性**: 各テストは他のテストに依存しない
4. **テストデータ**: テスト用のフィクスチャやモックを適切に使用

## プロジェクト固有の注意事項

- JavaScriptレンダリング関連のテストは、ブラウザの起動に時間がかかるため、必要最小限に留める
- Dockerを使用するテストは、CI環境では`CI=true`環境変数でスキップされる
- パフォーマンステストは`test/performance`ディレクトリに配置する